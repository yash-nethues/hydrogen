import{r as C,j as a,w as K,L,u as k}from"./components-CBM5eEXI.js";import{W as V,G,K as J}from"./index-BplfgVfs.js";import{u as H,P as X}from"./ProductPrice-CDmE5qIe.js";import{I as Q}from"./Image-DeF0sh8k.js";import"./Money-Cmkb11wd.js";const P=",",m={OPTION:":",END_OF_PREFIX:",",SEQUENCE_GAP:" ",RANGE:"-"},I=(()=>{const e=new Map;return function(t,r){var n;if(t.length===0)return!1;if(!e.has(r)){const i=new Set;for(const s of q(r)){i.add(s.join(P));for(let o=0;o<s.length;o++)i.add(s.slice(0,o+1).join(P))}e.set(r,i)}return!!((n=e.get(r))!=null&&n.has(t.join(P)))}})();function q(e){if(!e)return[];if(e.startsWith("v1_"))return M(z(e));throw new Error("Unsupported option value encoding")}const z=e=>e.replace(/^v1_/,"");function M(e){const t=/[ :,-]/g;let r=0,n;const i=[],s=[];let o=0,l=null;for(;n=t.exec(e);){const c=n[0],u=Number.parseInt(e.slice(r,n.index))||0;if(l!==null){for(;l<u;l++)s[o]=l,i.push([...s]);l=null}s[o]=u,c===m.RANGE?l=u:c===m.OPTION?o++:((c===m.SEQUENCE_GAP||c===m.END_OF_PREFIX&&e[n.index-1]!==m.END_OF_PREFIX)&&i.push([...s]),c===m.END_OF_PREFIX&&(s.pop(),o--)),r=t.lastIndex}const p=e.lastIndexOf("-");if(l!=null&&p>0){const c=parseInt(e.substring(p+1));for(;l<=c;l++)s[o]=l,i.push([...s])}return i}function B(e){return e.map(t=>Object.assign({},...t!=null&&t.optionValues?t.optionValues.map((r,n)=>({[r.name]:n})):[]))}function x(e){return Object.assign({},...e.map(t=>({[t.name]:t.value})))}function h(e){return JSON.stringify(x(e))}function T(e,t){return Array.isArray(e)?JSON.stringify(e.map((r,n)=>t[n][r.value])):JSON.stringify(Object.keys(e).map((r,n)=>t[n][e[r]]))}function W(e,t){return Object.assign({},...e.map(r=>({[T(r.selectedOptions||[],t)]:r})))}const _=["options","selectedOrFirstAvailableVariant","adjacentVariants"],Y=["handle","encodedVariantExistence","encodedVariantAvailability"];function d(e){return console.error(`[h2:error:getProductOptions] product.${e} is missing. Make sure you query for this field from the Storefront API.`),!1}function w(e,t=!1){var r;let n=!0;const i=Object.keys(e);if((t?[..._,...Y]:_).forEach(s=>{i.includes(s)||(n=d(s))}),e.options){const s=e==null?void 0:e.options[0];if(t&&!(s!=null&&s.name)&&(n=d("options.name")),(r=e==null?void 0:e.options[0])!=null&&r.optionValues){const o=e.options[0].optionValues[0];t&&!(o!=null&&o.name)&&(n=d("options.optionValues.name")),o!=null&&o.firstSelectableVariant?n=S(o.firstSelectableVariant,"options.optionValues.firstSelectableVariant",n,t):n=d("options.optionValues.firstSelectableVariant")}else n=d("options.optionValues")}return e.selectedOrFirstAvailableVariant&&(n=S(e.selectedOrFirstAvailableVariant,"selectedOrFirstAvailableVariant",n,t)),e.adjacentVariants&&e.adjacentVariants[0]&&(n=S(e.adjacentVariants[0],"adjacentVariants",n,t)),n?e:{}}function S(e,t,r,n){var i;let s=r;if(n&&!((i=e.product)!=null&&i.handle)&&(s=d(`${t}.product.handle`)),e.selectedOptions){const o=e.selectedOptions[0];o!=null&&o.name||(s=d(`${t}.selectedOptions.name`)),o!=null&&o.value||(s=d(`${t}.selectedOptions.value`))}else s=d(`${t}.selectedOptions`);return s}function Z(e){const t=w(e);if(!t.options)return[];const r={};t.options.map(i=>{var s;(s=i.optionValues)==null||s.map(o=>{if(o.firstSelectableVariant){const l=h(o.firstSelectableVariant.selectedOptions);r[l]=o.firstSelectableVariant}})}),t.adjacentVariants.map(i=>{const s=h(i.selectedOptions);r[s]=i});const n=t.selectedOrFirstAvailableVariant;if(n){const i=h(n.selectedOptions);r[i]=n}return Object.values(r)}function ee(e){const t=w(e,!0);if(!t.options)return[];const{options:r,selectedOrFirstAvailableVariant:n,adjacentVariants:i,encodedVariantExistence:s,encodedVariantAvailability:o,handle:l}=t,p=B(r),c=W(n?[n,...i]:i,p),u=x(n?n.selectedOptions:[]);return r.map((f,O)=>({...f,optionValues:f.optionValues.map(b=>{var g;const y={...u};y[f.name]=b.name;const N=T(y,p),E=JSON.parse(N).slice(0,O+1),U=I(E,s||""),F=I(E,o||""),j=c[N]||b.firstSelectableVariant,$=x(j.selectedOptions||[]),D=new URLSearchParams($),A=(g=j==null?void 0:j.product)==null?void 0:g.handle;return{...b,variant:j,handle:A,variantUriQuery:D.toString(),selected:u[f.name]===b.name,exists:U,available:F,isDifferentProduct:A!==l}})}))}function te(e){return C.useEffect(()=>{const t=new URLSearchParams(x(e||[])),r=new URLSearchParams(window.location.search),n=new URLSearchParams({...Object.fromEntries(r),...Object.fromEntries(t)});n.size>0&&window.history.replaceState({},"",`${window.location.pathname}?${n.toString()}`)},[JSON.stringify(e)]),null}function ne({image:e}){return e?a.jsx("div",{className:"product-image",children:a.jsx(Q,{alt:e.altText||"Product Image",aspectRatio:"1/1",data:e,sizes:"(min-width: 45em) 50vw, 100vw"},e.id)}):a.jsx("div",{className:"product-image"})}function re({analytics:e,children:t,disabled:r,lines:n,onClick:i}){return a.jsx(V,{route:"/cart",inputs:{lines:n},action:V.ACTIONS.LinesAdd,children:s=>a.jsxs(a.Fragment,{children:[a.jsx("input",{name:"analytics",type:"hidden",value:JSON.stringify(e)}),a.jsx("button",{type:"submit",onClick:i,disabled:r??s.state!=="idle",children:t})]})})}function ie({productOptions:e,selectedVariant:t}){const r=K(),{open:n}=H();return a.jsxs("div",{className:"product-form",children:[e.map(i=>i.optionValues.length===1?null:a.jsxs("div",{className:"product-options",children:[a.jsx("h5",{children:i.name}),a.jsx("div",{className:"product-options-grid",children:i.optionValues.map(s=>{const{name:o,handle:l,variantUriQuery:p,selected:c,available:u,exists:v,isDifferentProduct:f,swatch:O}=s;return f?a.jsx(L,{className:"product-options-item",prefetch:"intent",preventScrollReset:!0,replace:!0,to:`/products/${l}?${p}`,style:{border:c?"1px solid black":"1px solid transparent",opacity:u?1:.3},children:a.jsx(R,{swatch:O,name:o})},i.name+o):a.jsx("button",{type:"button",className:`product-options-item${v&&!c?" link":""}`,style:{border:c?"1px solid black":"1px solid transparent",opacity:u?1:.3},disabled:!v,onClick:()=>{c||r(`?${p}`,{replace:!0,preventScrollReset:!0})},children:a.jsx(R,{swatch:O,name:o})},i.name+o)})}),a.jsx("br",{})]},i.name)),a.jsx(re,{disabled:!t||!t.availableForSale,onClick:()=>{n("cart")},lines:t?[{merchandiseId:t.id,quantity:1,selectedVariant:t}]:[],children:t!=null&&t.availableForSale?"Add to cart":"Sold out"})]})}function R({swatch:e,name:t}){var i,s;const r=(s=(i=e==null?void 0:e.image)==null?void 0:i.previewImage)==null?void 0:s.url,n=e==null?void 0:e.color;return!r&&!n?t:a.jsx("div",{"aria-label":t,className:"product-option-label-swatch",style:{backgroundColor:n||"transparent"},children:!!r&&a.jsx("img",{src:r,alt:t})})}const ue=({data:e})=>[{title:`Hydrogen | ${(e==null?void 0:e.product.title)??""}`},{rel:"canonical",href:`/products/${e==null?void 0:e.product.handle}`}];function de(){const{product:e}=k(),t=G(e.selectedOrFirstAvailableVariant,Z(e));te(t.selectedOptions);const r=ee({...e,selectedOrFirstAvailableVariant:t}),{title:n,descriptionHtml:i}=e;return a.jsxs("div",{className:"product",children:[a.jsx(ne,{image:t==null?void 0:t.image}),a.jsxs("div",{className:"product-main",children:[a.jsx("h1",{children:n}),a.jsx(X,{price:t==null?void 0:t.price,compareAtPrice:t==null?void 0:t.compareAtPrice}),a.jsx("br",{}),a.jsx(ie,{productOptions:r,selectedVariant:t}),a.jsx("br",{}),a.jsx("br",{}),a.jsx("p",{children:a.jsx("strong",{children:"Description"})}),a.jsx("br",{}),a.jsx("div",{dangerouslySetInnerHTML:{__html:i}}),a.jsx("br",{})]}),a.jsx(J.ProductView,{data:{products:[{id:e.id,title:e.title,price:(t==null?void 0:t.price.amount)||"0",vendor:e.vendor,variantId:(t==null?void 0:t.id)||"",variantTitle:(t==null?void 0:t.title)||"",quantity:1}]}})]})}export{de as default,ue as meta};
